---
title: 'La nueva transformaci贸n JSX'
publishedAt: '9/23/2020'
description: 'Si bien React 17 no trae nuevas funciones, brindar谩 soporte para una nueva versi贸n de la transformaci贸n JSX.'
isOld: true
---

Siguiendo con el post anterior de React 17, lo vuelvo a decir: No contiene nuevas funciones. No obstante, hay algo importante que han anunciado ayer 22 de septiembre el equipo de React:

**React 17 brindar谩 soporte para una nueva versi贸n de la transformaci贸n JSX.**

## 驴Qu茅 es una transformaci贸n JSX?

Los navegadores como tal, no entienden JSX, por lo que la mayor铆a de los usuarios de React conf铆an en alg煤n compilador como Babel o TypeScript para **transformar el c贸digo JSX en JavaScript normal**. Muchos kit de herramientas preconfigurados como Create React App o Next.js tambi茅n incluyen una transformaci贸n JSX por de bajo.

Junto con el lanzamiento de React 17, el equipo de react quiere hacer algunas mejoras en la transformaci贸n de JSX, pero no quer铆an romper las configuraciones existentes. Es por eso que han trabajado junto con Babel para **ofrecer una nueva versi贸n reescrita de la transformaci贸n JSX** para las personas que quisieran actualizar.

La actualizaci贸n a la nueva transformaci贸n es completamente opcional, pero tiene algunos beneficios:

- Con la nueva transformaci贸n, se puede usar **JSX sin importar React**.
- Dependiendo de la configuraci贸n, la salida compilada puede **mejorar ligeramente el tama帽o del bundle**.
- Permitir谩 mejoras futuras que **reduzcan la cantidad de conceptos** que se necesita para aprender React.

**Esta actualizaci贸n no cambiar谩 la sintaxis JSX y no es necesaria.** La antigua transformaci贸n JSX seguir谩 funcionando como de costumbre y no hay planes para quitarle el soporte.

React 17 RC (Release Candidate) ya incluye soporte para la nueva transformaci贸n, as铆 que 隆hay que probarlo!. Para que sea m谩s f谩cil de adoptar, despu茅s del lanzamiento de React 17, tambi茅n planean respaldar su soporte a React 16.x, React 15.x y React 0.14.x.

Veamos m谩s de cerca las diferencias entre la transformaci贸n antigua y la nueva.

## 驴Qu茅 es diferente en la nueva transformaci贸n?

Cuando se usa JSX, el compilador lo transforma en llamadas de funci贸n React que el navegador puede entender. La **antigua transformaci贸n JSX **convierte JSX en `React.createElement(...)`.

Por ejemplo, digamos que el c贸digo se ve as铆:

```jsx
import React from 'react'

function App() {
  return <h1>Hola Mundo</h1>
}
```

Por debajo, la antigua transformaci贸n JSX lo convierte en JavaScript normal:

```js
import React from 'react'

function App() {
  return React.createElement('h1', null, 'Hola Mundo')
}
```

Sin embargo, esto no es perfecto:

- Debido a que JSX se compil贸 en `React.createElement`, `React` debe estar dentro del alcance si se usa JSX.
- Hay algunas mejoras de rendimiento y simplificaciones que `React.createElement` no permite.

Para resolver estos problemas, React 17 introduce dos nuevos puntos de entrada al paquete de React que est谩n destinados a ser utilizados solo por compiladores como Babel y TypeScript. En lugar de transformar JSX en `React.createElement`, **la nueva transformaci贸n JSX** importa autom谩ticamente funciones especiales de esos nuevos puntos de entrada en el paquete de React y las llama.

Digamos que nuestro c贸digo se ve as铆:

```jsx
function App() {
  return <h1>Hola Mundo</h1>
}
```

Esto es lo que compila la nueva transformaci贸n JSX:

```js
import { jsx as _jsx } from 'react/jsx-runtime'

function App() {
  return _jsx('h1', { children: 'Hola Mundo' })
}
```

Tengamos en cuenta, que en nuestro c贸digo original (JSX) y**a no se necesita importar React** para usar JSX. Pero a煤n se necesitar铆a importar React para usar Hooks u otras exportaciones que nos brinda React. De esto hablar茅 m谩s abajo.

**Este cambio es totalmente compatible con todo el c贸digo JSX que ya existe**, por lo que no se tendr谩 que cambiar los componentes.

---

## 驴C贸mo actualizar a la nueva transformaci贸n JSX?

Si no est谩 preparado para actualizar a la nueva transformaci贸n JSX o si se est谩 utilizando JSX para otra biblioteca, no hay que preocuparse. La transformaci贸n anterior no se eliminar谩 y seguir谩 siendo compatible.

Si se desea actualizar, se necesitar谩n dos cosas:

- **Una versi贸n de React que admita la nueva transformaci贸n** (actualmente, solo React 17 RC lo admite, pero despu茅s de que se haya lanzado oficialmente React 17.0, el equipo de React planea hacer veesiones compatibles adicionales para 0.14.x, 15.x y 16.x).
- **Un compilador compatible.**

Dado que la nueva transformaci贸n JSX no requiere que React est茅 dentro del alcance, tambi茅n el equipo de React ha preparado un script automatizado que eliminar谩 las importaciones innecesarias del c贸digo base.

### Create React App

Se ha agregado compatibilidad con Create React App y estar谩 disponible en la pr贸xima versi贸n v4.0, que actualmente se encuentra en beta.

### Next.js

Next.js v9.5.3+ ya usa la nueva transformaci贸n para versiones de React compatibles.

### Gatsby

Gatsby v2.24.5+ usa la nueva transformaci贸n para versiones compatibles

### Configuraci贸n manual de Babel

El soporte para la nueva transformaci贸n JSX est谩 disponible en Babel v7.9.0 y versiones superiores.

Primero, se deber谩 actualizar a la 煤ltima transformaci贸n de Babel y sus complementos.

Si se est谩 usando `@babel/plugin-transform-react-jsx`:

Para usuarios NPM

```bash
npm update @babel/core @babel/plugin-transform-react-jsx
```

Para usuarios Yarn

```bash
yarn upgrade @babel/core @babel/plugin-transform-react-jsx
```

Si se est谩 usando `@babel/preset-react`:

Para usuarios NPM

```bash
npm update @babel/core @babel/preset-react
```

Para usuarios Yarn

```bash
yarn upgrade @babel/core @babel/preset-react
```

Actualmente, el antiguo transformador (`"runtime": "classic"`) es la opci贸n predeterminada. Para habilitar la nueva transformaci贸n, se puede pasar `{"runtime": "automatic"}` como una opci贸n a `@babel/plugin-transform-react-jsx` o `@babel/preset-react`

```json title=".babelrc"
// @babel/preset-react
{
  "presets": [
    [
      "@babel/preset-react",
      {
        "runtime": "automatic"
      }
    ]
  ]
}
```

```json title=".babelrc"
// @babel/plugin-transform-react-jsx
{
  "presets": [
    [
      "@babel/plugin-transform-react-jsx",
      {
        "runtime": "automatic"
      }
    ]
  ]
}
```

A partir de Babel 8, `"automatic"` ser谩 el tiempo de ejecuci贸n predeterminado para ambos complementos.

### Eslint

Si se est谩 utilizando [eslint-plugin-react](https://github.com/yannickcr/eslint-plugin-reacthttp:// 'eslint-plugin-react'), las reglas `react/jsx-uses-react` y `react/react-in-jsx-scope` ya no son necesarias y se pueden desactivar o eliminar (esto lo vimos en el post de standardjs).

```json title=".eslintrc.json"
{
  // ...
  "rules": {
    // ...
    "react/jsx-uses-react": "off",
    "react/react-in-jsx-scope": "off"
  }
}
```

### TypeScript

TypeScript admite la transformaci贸n JSX en v4.1 beta.

### Flow

Flow admite la nueva transformaci贸n JSX en v0.126.0 y posteriores.

---

## Eliminaci贸n de importaciones React no utilizadas

Debido a que la nueva transformaci贸n JSX importar谩 autom谩ticamente las funciones `react/jsx-runtime` necesarias, React ya no necesitar谩 estar dentro del alcance cuando se use JSX. Esto podr铆a dar lugar a importaciones de React no utilizadas en el c贸digo. No est谩 de m谩s conversvarlas, pero si se desea eliminarlas, la recomendaci贸n es que ejecute un [script ](https://medium.com/@cpojer/effective-javascript-codemods-5a6686bb46fb 'script ') para eliminarlas autom谩ticamente.

```bash
cd nombre-proyecto
npx react-codemod update-react-imports
```

Al ejecutar este codificador:

- Se eliminan todas las importaciones de React no utilizadas como resultado de la actualizaci贸n a la nueva transformaci贸n JSX.
- Se cambian todas las importaciones predeterminadas (es decir `import React from 'react`) a importaciones con nombre desestructuradas (ej: `import { useState } from 'react`), que el estilo preferido en el futuro. Este c贸digo no afectar谩 las importaciones de espacios de nombres existentes (es decir `import * as React from 'react`), que tambi茅n es un estilo v谩lido. Las importaciones predeterminadas seguir谩n funcionando en React 17, pero a largo plazo, se recomienda alejarse de ellas.

Por ejemplo:

```jsx
import React from 'react'

function App() {
  return <h1>Hola Mundo</h1>
}
```

Ser谩 reemplazado por:

```jsx
function App() {
  return <h1>Hola Mundo</h1>
}
```

Si se usa alguna otra importaci贸n de React, por ejemplo, un Hook, entonces el codificador lo convertir谩 en una importaci贸n nombrada.

Por ejemplo:

```jsx
import React from 'react'

function App() {
  const [text, setText] = React.useState('Hola Mundo')
  return <h1>{text}</h1>
}
```

Ser谩 reemplazado por:

```jsx
import { useState } from 'react'

function App() {
  const [text, setText] = useState('Hola Mundo')
  return <h1>{text}</h1>
}
```

Adem谩s de limpiar las importaciones no utilizadas, esto tambi茅n ayudar谩 a prepararse para una futura principal versi贸n de React (no 17, sino siguientes...) que admitir谩 m贸dulos ES y no se tendr谩 que hacer una exportaci贸n predeterminada.

Bueno, este era m谩s corto que el anterior.

Se vienen grandes cosas en React 17 锔 !!!

Fuente: https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html (ingl茅s)
