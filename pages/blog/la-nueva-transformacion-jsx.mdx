import { LayoutPost } from 'components/layout/post'
import { meta } from '_posts/la-nueva-transformacion-jsx'

export default LayoutPost({ ...meta })

Siguiendo con el post anterior de React 17, lo vuelvo a decir: No contiene nuevas funciones. No obstante, hay algo importante que han anunciado ayer 22 de septiembre el equipo de React:

**React 17 brindar치 soporte para una nueva versi칩n de la transformaci칩n JSX.**

## 쯈u칠 es una transformaci칩n JSX?

Los navegadores como tal, no entienden JSX, por lo que la mayor칤a de los usuarios de React conf칤an en alg칰n compilador como Babel o TypeScript para **transformar el c칩digo JSX en JavaScript normal**. Muchos kit de herramientas preconfigurados como Create React App o Next.js tambi칠n incluyen una transformaci칩n JSX por de bajo.

Junto con el lanzamiento de React 17, el equipo de react quiere hacer algunas mejoras en la transformaci칩n de JSX, pero no quer칤an romper las configuraciones existentes. Es por eso que han trabajado junto con Babel para **ofrecer una nueva versi칩n reescrita de la transformaci칩n JSX** para las personas que quisieran actualizar.

La actualizaci칩n a la nueva transformaci칩n es completamente opcional, pero tiene algunos beneficios:

- Con la nueva transformaci칩n, se puede usar **JSX sin importar Reac**t.
- Dependiendo de la configuraci칩n, la salida compilada puede **mejorar ligeramente el tama침o del bundle**.
- Permitir치 mejoras futuras que **reduzcan la cantidad de conceptos** que se necesita para aprender React.

**Esta actualizaci칩n no cambiar치 la sintaxis JSX y no es necesaria.** La antigua transformaci칩n JSX seguir치 funcionando como de costumbre y no hay planes para quitarle el soporte.

React 17 RC (Release Candidate) ya incluye soporte para la nueva transformaci칩n, as칤 que 춰hay que probarlo!. Para que sea m치s f치cil de adoptar, despu칠s del lanzamiento de React 17, tambi칠n planean respaldar su soporte a React 16.x, React 15.x y React 14.x.

Veamos m치s de cerca las diferencias entre la transformaci칩n antigua y la nueva.

## 쯈u칠 es diferente en la nueva transformaci칩n?

Cuando se usa JSX, el compilador lo transforma en llamadas de funci칩n React que el navegador puede entender. La **antigua transformaci칩n JSX **convierte JSX en `React.createElement(...)`.

Por ejemplo, digamos que el c칩digo se ve as칤:

```jsx
import React from 'react'

function App() {
	return <h1>Hola Mundo</h1>
} 
```

Por debajo, la antigua transformaci칩n JSX lo convierte en JavaScript normal:

```js
import React from 'react'

function App() {
	return React.createElement('h1', null, 'Hola Mundo')
}
```

Sin embargo, esto no es perfecto:

- Debido a que JSX se compil칩 en `React.createElement`, `React` debe estar dentro del alcance si se usa JSX.
- Hay algunas mejoras de rendimiento y simplificaciones que `React.createElement` no permite.

Para resolver estos problemas, React 17 introduce dos nuevos puntos de entrada al paquete de React que est치n destinados a ser utilizados solo por compiladores como Babel y TypeScript. En lugar de transformar JSX en `React.createElement`, **la nueva transformaci칩n JSX** importa autom치ticamente funciones especiales de esos nuevos puntos de entrada en el paquete de React y las llama.

Digamos que nuestro c칩digo se ve as칤:

```jsx
function App() {
	return <h1>Hola Mundo</h1>
}
```

Esto es lo que compila la nueva transformaci칩n JSX:

```js
import {jsx as _jsx} from 'react/jsx-runtime'

function App() {
	return _jsx('h1', { children: 'Hola Mundo' })
}
```

Tengamos en cuenta, que en nuestro c칩digo original (JSX) y**a no se necesita importar React** para usar JSX. Pero a칰n se necesitar칤a importar React para usar Hooks u otras exportaciones que nos brinda React. De esto hablar칠 m치s abajo.

**Este cambio es totalmente compatible con todo el c칩digo JSX que ya existe**, por lo que no se tendr치 que cambiar los componentes.


------------

## 쮺칩mo actualizar a la nueva transformaci칩n JSX?

Si no est치 preparado para actualizar a la nueva transformaci칩n JSX o si se est치 utilizando JSX para otra biblioteca, no hay que preocuparse. La transformaci칩n anterior no se eliminar치 y seguir치 siendo compatible.

Si se desea actualizar, se necesitar치n dos cosas:

- **Una versi칩n de React que admita la nueva transformaci칩n** (actualmente, solo React 17 RC lo admite, pero despu칠s de que se haya lanzado oficialmente React 17.0, el equipo de React planea hacer veesiones compatibles adicionales para 0.14.x, 15.x y 16.x).
- **Un compilador compatible.**

Dado que la nueva transformaci칩n JSX no requiere que React est칠 dentro del alcance, tambi칠n el equipo de React ha preparado un script automatizado que eliminar치 las importaciones innecesarias del c칩digo base.

### Create React App

Se ha agregado compatibilidad con Create React App y estar치 disponible en la pr칩xima versi칩n v4.0, que actualmente se encuentra en beta.

### Next.js

Next.js v9.5.3+ ya usa la nueva transformaci칩n para versiones de React compatibles.

### Gatsby

Gatsby v2.24.5+ usa la nueva transformaci칩n para versiones compatibles

### Configuraci칩n manual de Babel

El soporte para la nueva transformaci칩n JSX est치 disponible en Babel v7.9.0 y versiones superiores.

Primero, se deber치 actualizar a la 칰ltima transformaci칩n de Babel y sus complementos.

Si se est치 usando `@babel/plugin-transform-react-jsx`:

Para usuarios NPM

```bash
npm update @babel/core @babel/plugin-transform-react-jsx
```

Para usuarios Yarn

```bash
yarn upgrade @babel/core @babel/plugin-transform-react-jsx
```

Si se est치 usando `@babel/preset-react`:

```bash
npm update @babel/core @babel/preset-react
```

Para usuarios Yarn

```bash
yarn upgrade @babel/core @babel/preset-react
```

Actualmente, el antiguo transformador (`"runtime": "classic"`) es la opci칩n predeterminada. Para habilitar la nueva transformaci칩n, se puede pasar `{"runtime": "automatic"}` como una opci칩n a `@babel/plugin-transform-react-jsx` o `@babel/preset-react`

```json
// @babel/preset-react
{
	"presets": [
		["@babel/preset-react", {
			"runtime": "automatic"
		}]
	]
}
```

```json
// @babel/plugin-transform-react-jsx
{
	"presets": [
		["@babel/plugin-transform-react-jsx", {
			"runtime": "automatic"
		}]
	]
}
```

A partir de Babel 8, `"automatic"` ser치 el tiempo de ejecuci칩n predeterminado para ambos complementos.

### Eslint

Si se est치 utilizando [eslint-plugin-react](https://github.com/yannickcr/eslint-plugin-reacthttp:// "eslint-plugin-react"), las reglas `react/jsx-uses-react` y `react/react-in-jsx-scope` ya no son necesarias y se pueden desactivar o eliminar (esto lo vimos en el post de standardjs).

```json
{
	// ...
	"rules": {
		// ...
		"react/jsx-uses-react": "off",
		"react/react-in-jsx-scope": "off"
	}
}
```

### TypeScript

TypeScript admite la transformaci칩n JSX en v4.1 beta.

### Flow

Flow admite la nueva transformaci칩n JSX en v0.126.0 y posteriores.


------------

## Eliminaci칩n de importaciones React no utilizadas

Debido a que la nueva transformaci칩n JSX importar치 autom치ticamente las funciones `react/jsx-runtime` necesarias, React ya no necesitar치 estar dentro del alcance cuando se use JSX. Esto podr칤a dar lugar a importaciones de React no utilizadas en el c칩digo. No est치 de m치s conversvarlas, pero si se desea eliminarlas, la recomendaci칩n es que ejecute un [script ](https://medium.com/@cpojer/effective-javascript-codemods-5a6686bb46fb "script ") para eliminarlas autom치ticamente.

```bash
cd nombre-proyecto
npx react-codemod update-react-imports
```

Al ejecutar este codificador:

- Se eliminan todas las importaciones de React no utilizadas como resultado de la actualizaci칩n a la nueva transformaci칩n JSX.
- Se cambian todas las importaciones predeterminadas (es decir `import React from 'react`) a importaciones con nombre desestructuradas (ej: `import { useState } from 'react`), que el estilo preferido en el futuro. Este c칩digo no afectar치 las importaciones de espacios de nombres existentes (es decir `import * as React from 'react`), que tambi칠n es un estilo v치lido. Las importaciones predeterminadas seguir치n funcionando en React 17, pero a largo plazo, se recomienda alejarse de ellas.

Por ejemplo:

```jsx
import React from 'react'

function App() {
	return <h1>Hola Mundo</h1>
}
```

Ser치 reemplazado por:

```jsx
function App() {
	return <h1>Hola Mundo</h1>
}
```

Si se usa alguna otra importaci칩n de React, por ejemplo, un Hook, entonces el codificador lo convertir치 en una importaci칩n nombrada.

Por ejemplo:

```jsx
import React from 'react'

function App() {
	const [text, setText] = React.useState('Hola Mundo')
	return <h1>{text}</h1>
}
```

Ser치 reemplazado por:

```jsx
import { useState } from 'react'

function App() {
	const [text, setText] = useState('Hola Mundo')
	return <h1>{text}</h1>
}
```

Adem치s de limpiar las importaciones no utilizadas, esto tambi칠n ayudar치 a prepararse para una futura principal versi칩n de React (no 17, sino siguientes...) que admitir치 m칩dulos ES y no se tendr치 que hacer una exportaci칩n predeterminada.

Bueno, este era m치s corto que el anterior.

Se vienen grandes cosas en React 17 丘勇 游땸!!!

Fuente: https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html (ingl칠s)